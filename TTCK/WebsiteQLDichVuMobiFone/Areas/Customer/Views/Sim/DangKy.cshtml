@{
    ViewData["Title"] = "Đăng Ký SIM";
    var sim = ViewBag.Sim as WebsiteQLDichVuMobiFone.Models.Sim;
    var goiDaChon = ViewBag.GoiDaChon as WebsiteQLDichVuMobiFone.Models.GoiDangKy;
    var phuongThucVanChuyen = ViewBag.PhuongThucVanChuyen as List<WebsiteQLDichVuMobiFone.Models.PhuongThucVanChuyen>;
}

<div class="container mt-4">
    <h3>Đăng Ký SIM</h3>
    <div class="row">
        <!-- Form thông tin khách hàng -->
        <div class="col-md-6">
            <h4>Thông tin khách hàng</h4>
            <form method="post" asp-action="DangKySim">
                <div class="mb-3">
                    <label for="TenKhachHang" class="form-label">Tên khách hàng:</label>
                    <input type="text" name="TenKhachHang" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label for="SoDienThoai" class="form-label">Số điện thoại:</label>
                    <input type="text" name="SoDienThoai" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label for="Email" class="form-label">Email:</label>
                    <input type="email" name="Email" class="form-control" />
                </div>
                <div class="mb-3">
                    <label for="DiaDiemNhan" class="form-label">Địa chỉ nhận hàng:</label>
                    <input type="text" name="DiaDiemNhan" class="form-control" required />
                </div>
                <div class="mb-3">
                    <label for="PhuongThucVanChuyen" class="form-label">Phương thức vận chuyển:</label>
                    <select name="PhuongThucVanChuyen" class="form-select" required>
                        @foreach (var ptvc in phuongThucVanChuyen)
                        {
                            <option value="@ptvc.IdphuongThucVc">@ptvc.TenVanChuyen - @ptvc.GiaVanChuyen VND</option>
                        }
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Hoàn tất đăng ký</button>
            </form>
        </div>

        <!-- Hiển thị thông tin SIM và gói đăng ký -->
        <div class="col-md-6">
            <h4>Thông tin SIM và gói đăng ký</h4>
            @if (sim != null && goiDaChon != null)
            {
                <p><strong>Số thuê bao:</strong> @sim.SoThueBao</p>
                <p><strong>Loại thuê bao:</strong> @(sim.IdloaiSoNavigation?.TenLoaiSo ?? "Không xác định")</p>
                <p><strong>Phí hòa mạng:</strong> @sim.PhiHoaMang VND</p>
                <p><strong>Gói cước:</strong> @goiDaChon.TenGoi - @goiDaChon.GiaGoi VND</p>
                <p><strong>Thời hạn:</strong> @goiDaChon.ThoiHan ngày</p>
            }
            <div class="mt-3 p-3 bg-light">
                <h5>Tổng tiền</h5>
                <p>Phí hòa mạng: @sim.PhiHoaMang VND</p>
                <p>Gói cước: @goiDaChon.GiaGoi VND</p>
                <p>Phí vận chuyển: <span id="phiVanChuyen">0</span> VND</p>
                <hr />
                <p><strong>Tổng cộng: <span id="tongTien">0</span> VND</strong></p>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelector("select[name='PhuongThucVanChuyen']").addEventListener("change", function() {
        const phiVC = this.options[this.selectedIndex].text.split("-")[1].trim().replace(" VND", "");
        document.getElementById("phiVanChuyen").textContent = phiVC;
        const tongTien = parseInt("@sim.PhiHoaMang") + parseInt("@goiDaChon.GiaGoi") + parseInt(phiVC);
        document.getElementById("tongTien").textContent = tongTien;
    });
</script>
